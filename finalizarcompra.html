<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <title>Finalizar compra</title>
    <link rel="stylesheet" href="style.css">
</head>

<body>

    <h2 style="text-align:center; margin-top:20px;">Finalizar compra</h2>

    <div style="max-width:900px; margin:auto; padding:20px; display:flex; gap:40px;">

        <!-- üßç FORMULARIO DEL COMPRADOR -->
        <div style="flex:1; border:1px solid #ddd; padding:20px; border-radius:10px;">
            <h3>Datos del comprador</h3>

            <form id="checkout-form">

                <label>Nombre *</label>
                <input type="text" id="nombre" required style="width:100%; padding:8px; margin-bottom:10px;">

                <label>Apellidos *</label>
                <input type="text" id="apellidos" required style="width:100%; padding:8px; margin-bottom:10px;">

                <label>Email *</label>
                <input type="email" id="email" required style="width:100%; padding:8px; margin-bottom:10px;">

                <label>Tel√©fono *</label>
                <input type="tel" id="telefono" required style="width:100%; padding:8px; margin-bottom:10px;">

                <label>Direcci√≥n *</label>
                <input type="text" id="direccion" required style="width:100%; padding:8px; margin-bottom:10px;">

                <label>Ciudad *</label>
                <input type="text" id="ciudad" required style="width:100%; padding:8px; margin-bottom:10px;">

                <label>C√≥digo Postal *</label>
                <input type="text" id="cp" required style="width:100%; padding:8px; margin-bottom:10px;">

                <label>Pa√≠s *</label>
                <input type="text" id="pais" required style="width:100%; padding:8px; margin-bottom:10px;">

            </form>
        </div>


        <!-- üõí RESUMEN DE COMPRA -->
        <div style="flex:1; border:1px solid #ddd; padding:20px; border-radius:10px;">
            <h3>Resumen del pedido</h3>

            <div id="checkout-items"></div>

            <hr>

            <p style="font-size:18px;">
                Subtotal: <strong id="subtotal"></strong>
            </p>

            <p style="font-size:18px;">
                Env√≠o: <strong>5,00 ‚Ç¨</strong>
            </p>

            <p style="font-size:20px; margin-top:10px;">
                Total final: <strong id="total-final"></strong>
            </p>

            <h3 style="margin-top:25px;">M√©todo de pago</h3>

            <select id="metodoPago" style="width:100%; padding:10px; margin-bottom:20px;">
                <option value="">Seleccione un m√©todo</option>
                <option value="tarjeta">Tarjeta (Visa / Mastercard)</option>
                <option value="paypal">PayPal</option>
                <option value="bizum">Bizum</option>
            </select>

            <!-- FORMULARIO DE PAGO CON TARJETA -->
            <div id="formTarjeta"
                style="display:none; border:1px solid #ccc; padding:15px; border-radius:8px; margin-top:15px;">
                <label>Nombre del titular</label>
                <input type="text" id="titular" style="width:100%; padding:8px; margin-bottom:10px;">

                <label>N√∫mero de tarjeta</label>
                <input type="text" id="numTarjeta" maxlength="16" placeholder="1111222233334444"
                    style="width:100%; padding:8px; margin-bottom:10px;">

                <label>Fecha de expiraci√≥n</label>
                <input type="text" id="exp" maxlength="5" placeholder="MM/AA"
                    style="width:100%; padding:8px; margin-bottom:10px;">

                <label>CVV</label>
                <input type="password" id="cvv" maxlength="3" placeholder="123"
                    style="width:100%; padding:8px; margin-bottom:10px;">
            </div>

            <!-- FORMULARIO DE PAGO CON PAYPAL-->
            <div id="formPayPal"
                style="display:none; border:1px solid #ccc; padding:15px; border-radius:8px; margin-top:15px;">
                <label>Email de PayPal *</label>
                <input type="email" id="paypalEmail" placeholder="usuario@correo.com"
                    style="width:100%; padding:8px; margin-bottom:10px;">

                <label>Confirmar email *</label>
                <input type="email" id="paypalEmail2" placeholder="Repite tu email"
                    style="width:100%; padding:8px; margin-bottom:10px;">
            </div>

            <!-- FORMULARIO DE PAGO CON BIZUM -->
            <div id="formBizum"
                style="display:none; border:1px solid #ccc; padding:15px; border-radius:8px; margin-top:15px;">
                <label>N√∫mero de tel√©fono asociado a Bizum *</label>
                <input type="text" id="bizumTelefono" maxlength="9" placeholder="600123456"
                    style="width:100%; padding:8px; margin-bottom:10px;">

                <label>C√≥digo Bizum (generado desde tu app bancaria) *</label>
                <input type="text" id="bizumCodigo" maxlength="6" placeholder="123456"
                    style="width:100%; padding:8px; margin-bottom:10px;">
            </div>

            <button onclick="confirmarPedido()"
                style="margin-top:25px; padding:12px 20px; background:black; color:white; width:100%;">
                Confirmar pedido
            </button>

            <script>
                /* ---------------------------
                    LISTA DE PRODUCTOS (MISMA QUE TU JS PRINCIPAL)
                ---------------------------- */
                const productos = [
                    { nombre: "Camiseta b√°sica", precio: 20, img: "imagenes/camisetas.png" },
                    { nombre: "Zapatillas deportivas", precio: 60, img: "imagenes/zapatillas.png" },
                    { nombre: "Auriculares Bluetooth", precio: 45, img: "imagenes/auriculares.png" },
                    { nombre: "Pantal√≥n vaquero", precio: 40, img: "imagenes/pantalon.png" },
                    { nombre: "Bolso de cuero", precio: 90, img: "imagenes/bolso_cuero.png" },
                    { nombre: "Sudadera oversize", precio: 35, img: "imagenes/sudadera.png" },
                    { nombre: "Reloj inteligente", precio: 120, img: "imagenes/relojes.png" },
                    { nombre: "Zapatos de vestir", precio: 70, img: "imagenes/calzado_vestir.png" },
                    { nombre: "Auriculares Pro", precio: 180, img: "imagenes/auricularespro.png" },
                    { nombre: "Chaqueta impermeable", precio: 55, img: "imagenes/chaqueta_impermiable.png" },
                    { nombre: "Sandalias verano", precio: 30, img: "imagenes/sandalia_verano.png" },
                    { nombre: "Silla", precio: 110, img: "imagenes/silla1.png" },
                    { nombre: "Laptop", precio: 180, img: "imagenes/laptop.png" },
                    { nombre: "Smartphone", precio: 55, img: "imagenes/smartphone.png" }
                ];


                /* ---------------------------
                      CARGAR DATOS DEL CARRITO
                ---------------------------- */
                function cargarCheckout() {
                    const cart = JSON.parse(localStorage.getItem("cart") || "[]");
                    const subtotalGuardado = parseFloat(localStorage.getItem("cartTotal") || "0");

                    const cont = document.getElementById("checkout-items");
                    cont.innerHTML = "";

                    cart.forEach(item => {
                        const p = productos[item.id];

                        const div = document.createElement("div");
                        div.style.display = "flex";
                        div.style.gap = "20px";
                        div.style.marginBottom = "15px";
                        div.style.alignItems = "center";

                        div.innerHTML = `
            <img src="${p.img}" style="width:70px; height:70px; border-radius:8px;">
            <div style="flex:1;">
                <h4>${p.nombre}</h4>
                <p>Cantidad: ${item.qty}</p>
                <p>${p.precio} ‚Ç¨</p>
            </div>
            <strong>${(p.precio * item.qty).toFixed(2)} ‚Ç¨</strong>
        `;

                        cont.appendChild(div);
                    });

                    document.getElementById("subtotal").textContent =
                        subtotalGuardado.toFixed(2).replace(".", ",") + " ‚Ç¨";

                    const envio = 5;
                    const totalFinal = subtotalGuardado + envio;

                    document.getElementById("total-final").textContent =
                        totalFinal.toFixed(2).replace(".", ",") + " ‚Ç¨";
                }


                /* ---------------------------
                          CONFIRMAR PEDIDO
                ---------------------------- */
                function confirmarPedido() {

                    /* Validaci√≥n datos del comprador */
                    const campos = ["nombre", "apellidos", "email", "telefono", "direccion", "ciudad", "cp", "pais"];
                    for (let c of campos) {
                        if (!document.getElementById(c).value.trim()) {
                            alert("Por favor, completa todos los campos obligatorios.");
                            return;
                        }
                    }

                    const metodo = document.getElementById("metodoPago").value;

                    if (!metodo) {
                        alert("Seleccione un m√©todo de pago.");
                        return;
                    }

                    // Validaci√≥n TARJETA
                    if (metodo === "tarjeta") {
                        if (
                            !document.getElementById("titular").value.trim() ||
                            !document.getElementById("numTarjeta").value.trim() ||
                            !document.getElementById("exp").value.trim() ||
                            !document.getElementById("cvv").value.trim()
                        ) {
                            alert("Complete todos los datos de la tarjeta.");
                            return;
                        }
                    }

                    // Validaci√≥n PAYPAL
                    if (metodo === "paypal") {

                        const email1 = document.getElementById("paypalEmail").value.trim();
                        const email2 = document.getElementById("paypalEmail2").value.trim();

                        if (!email1 || !email2) {
                            alert("Debe ingresar y confirmar su email de PayPal.");
                            return;
                        }

                        if (email1 !== email2) {
                            alert("Los emails de PayPal no coinciden.");
                            return;
                        }
                    }

                    // Validaci√≥n BIZUM
                    if (metodo === "bizum") {

                        if (
                            !document.getElementById("bizumTelefono").value.trim() ||
                            !document.getElementById("bizumCodigo").value.trim()
                        ) {
                            alert("Ingrese su tel√©fono y el c√≥digo Bizum.");
                            return;
                        }
                    }


                    alert("¬°Pedido confirmado!\nGracias por tu compra üòä");

                    localStorage.removeItem("cart");
                    localStorage.removeItem("cartTotal");

                    window.location.href = "index.html";
                }
                cargarCheckout();

                document.getElementById("metodoPago").addEventListener("change", function () {
                    const formTarjeta = document.getElementById("formTarjeta");

                    if (this.value === "tarjeta") {
                        formTarjeta.style.display = "block";
                    } else {
                        formTarjeta.style.display = "none";
                    }
                });


                document.getElementById("metodoPago").addEventListener("change", function () {

                    const formTarjeta = document.getElementById("formTarjeta");
                    const formPayPal = document.getElementById("formPayPal");
                    const formBizum = document.getElementById("formBizum");

                    // Ocultar todos
                    formTarjeta.style.display = "none";
                    formPayPal.style.display = "none";
                    formBizum.style.display = "none";

                    // Mostrar seg√∫n selecci√≥n
                    if (this.value === "tarjeta") formTarjeta.style.display = "block";
                    if (this.value === "paypal") formPayPal.style.display = "block";
                    if (this.value === "bizum") formBizum.style.display = "block";
                });
            </script>

</body>

</html>